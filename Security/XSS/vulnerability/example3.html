<!-- Run with live-server -->
<!-- This illustrates Example of Unauthorized Access -->
<!-- We can pass Malicious Code : <img src='error.gif' onerror="createPost('HACK_TITLE','HACK_DESCRIPTION');"/> to 'name' query param -->
<!-- This will send a post request to '/post' endpoint with title as 'HACK_TITLE' and description as 'HACK_DESCRIPTION' -->

<!-- This is how it works :
1. <img src='error.gif' onerror="..."/>: This is an image tag with an onerror attribute.
2. src='error.gif': The src attribute points to a non-existent or faulty image (error.gif). Since the image cannot be loaded, it triggers the onerror event.
3. onerror="createPost('HACK_TITLE','HACK_DESCRIPTION');": The onerror attribute specifies JavaScript code to execute when an error occurs while loading the image.
In this case, it calls the createPost function with the arguments 'HACK_TITLE' and 'HACK_DESCRIPTION' -->

<!-- Impact :- -->
<!-- If the server endpoint ('/post') does not have appropriate checks or validation, this could lead to unintended actions, such as creating posts with malicious content, injecting further scripts, or manipulating data. -->

<!-- Note : Please convert the malicious code to url encoded format by encodeURIComponent('malicious code') -->
<!-- After encoding, the final URL will look like this : -->
<!-- http://127.0.0.1:5500/Security/XSS/vulnerability/example3.html?name=%3Cimg%20src%3D%27error.gif%27%20onerror%3D%22createPost(%27HACK_TITLE%27%2C%27HACK_DESCRIPTION%27)%3B%22%2F%3E -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XSS Example</title>
  </head>
  <body>
    <!-- Vulnerable Code -->
    <div>
      Welcome, <span id="username"></span>! TimeZone,
      <span id="timezone"></span>!
    </div>

    <script>
      // Function to set a cookie, mostly this will be set from server
      function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
        const expires = "expires=" + date.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
      }

      // Example: Set a cookie named "exampleCookie" with value "Hello, Cookie!" that expires in 7 days
      setCookie("exampleCookie", "Hello, Cookie!", 7);
    </script>

    <!-- Vulnerable Code -->
    <script>
      const params = new URLSearchParams(window.location.search);
      const name = params.get("name");
      document.getElementById("username").innerHTML = name;
    </script>

    <script>
      // This JavaScript code defines a function named createPost that sends an HTTP POST request to a server endpoint (presumably at '/post').
      // The function is designed to submit data, specifically a title and description, which could be used to create a post or a similar entry on the server.
      // Hereâ€™s a breakdown of the code:
      
      function createPost(title, description) {
        // Below line creates a new XMLHttpRequest object named xhr. This object is used to interact with servers and send HTTP requests.
        var xhr = new XMLHttpRequest();
        // Below line configures the xhr object to send a POST request to the URL '/post'. The true argument specifies that the request should be asynchronous, meaning the code execution will continue without waiting for the request to complete.
        xhr.open("POST", '/post', true);
        console.log(document.cookie);
        xhr.withCredentials = true;
        xhr.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded"
        );
        // Below line sends the actual request with the data.
        // The data being sent is a URL-encoded string that contains the 'title' and 'description' values passed to the createPost function.
        // In this case, txtName is assigned the value of title, and mtxMessage is assigned the value of description.
        xhr.send(`txtName=${title}&mtxMessage=${description}`);
      }
    </script>
  </body>
</html>
